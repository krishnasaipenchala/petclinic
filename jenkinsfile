pipeline {
	agent any
	tools{
	    maven 'M3.6'
	}
	stages{
    stage('build'){
			steps{
				sh 'mvn clean package'
			}
		}
		stage('archival'){
			steps {
				archiveArtifacts artifacts: 'target/*.?ar', followSymlinks: false
			}
		}
		stage('unit tests'){
			steps{
				junit 'target/surefire-reports/*.xml'
			}
		}
		stage('nexus uploader'){
			steps{
				nexusArtifactUploader artifacts: [[artifactId: 'spring-petclinic', classifier: '', file: 'target/petclinic.war', type: 'war']], credentialsId: 'nexuscred', groupId: 'org.springframework.samples', nexusUrl: '13.58.26.242:8081/nexus', nexusVersion: 'nexus2', protocol: 'http', repository: 'snapshots', version: '4.2.6-SNAPSHOT'
			}
		}
	}
	post{
		failure{
			notify('failed')
		}
		success{
			notify('success')
		}
	}	
}
def notify(status) {
	emailext ( 
        to: 'krishnapenchala2299@gmail.com',    
        subject: "${status} - ${env.JOB_NAME}",
        body: "$status - Jenkins job ${env.BUILD_URL}"
    )

}
